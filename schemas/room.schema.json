{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "room.schema.json",
  "title": "Room/Workspace Runtime",
  "$metadata": { "semver": "1.0.0" },
  "$ref": "#/$defs/Room",
  "$defs": {
    "Room": {
      "type": "object",
      "required": ["id", "state", "config", "created_at"],
      "properties": {
        "id": { "$ref": "common.defs.json#/$defs/RoomId" },
        "state": { "$ref": "common.defs.json#/$defs/RoomState" },
        "created_at": { "$ref": "common.defs.json#/$defs/IsoDateTime" },
        "updated_at": { "$ref": "common.defs.json#/$defs/IsoDateTime" },
        "config": {
          "type": "object",
          "required": ["env"],
          "properties": {
            "mounts": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id", "kind"],
                "properties": {
                  "id": { "type": "string" },
                  "kind": { "enum": ["mcp", "fs", "secret", "kv"] },
                  "config": { "type": "object" },
                  "visibility": { "enum": ["room", "entity"] },
                  "policies": { "$ref": "common.defs.json#/$defs/Policy" }
                },
                "additionalProperties": false
              }
            },
            "env": { "$ref": "common.defs.json#/$defs/KeyValue" },
            "secrets": { "$ref": "common.defs.json#/$defs/KeyValue" }
          },
          "additionalProperties": false
        },
        "contracts": {
          "type": "object",
          "properties": {
            "inputs": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "type"],
                "properties": {
                  "name": { "type": "string" },
                  "type": { "$ref": "common.defs.json#/$defs/MimeOrLogicalType" },
                  "required": { "type": "boolean", "default": true }
                },
                "additionalProperties": false
              }
            },
            "outputs": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "type"],
                "properties": {
                  "name": { "type": "string" },
                  "type": { "$ref": "common.defs.json#/$defs/MimeOrLogicalType" }
                },
                "additionalProperties": false
              }
            }
          },
          "additionalProperties": false
        },
        "x-extensions": { "$ref": "common.defs.json#/$defs/Ext" }
      },
      "additionalProperties": false
    }
  }
}
